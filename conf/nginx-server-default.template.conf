server {
  sub_filter_once off;
  sub_filter_types *;
  sub_filter **CSP_NONCE** $ssl_session_id;
  # proxy_set_header Accept-Encoding "";
  # Add strict csp header config
  add_header Content-Security-Policy
    "default-src 'self';
     connect-src 'self' https://*.data.amsterdam.nl https://api.usabilla.com https://sentry.data.amsterdam.nl https://siteimproveanalytics.com https://mijn-bff.amsterdam.nl https://acc.mijn-bff.amsterdam.nl https://api.swiftype.com;
     script-src 'self' https://analytics.data.amsterdam.nl https://*.usabilla.com http://*.usabilla.com https://siteimproveanalytics.com 'sha256-blLDIhKaPEZDhc4WD45BC7pZxW4WBRp7E5Ne1wC/vdw=' 'sha256-4+oZEPrU9EasYI748EYT+1B2DZCdZ19UGaX/gpLWwf4=' 'sha256-wZZTZ+IFA1sJKRjoJqzAI+c8330AH2nKu0Oznam9G7E=' 'sha256-z4OPXhHK/z0DCJWee4o7z7aQ9pnJBb4IEiBGGjUR7vg=' sha256-TyfshbRrF6wudNLAp2/kvGBI/xQXP3FMWE3hmehgmjQ=';
     img-src 'self' https://*.amsterdam.nl https://*.data.amsterdam.nl https://d6tizftlrpuof.cloudfront.net https://*.usabilla.com https://6004851.global.siteimproveanalytics.io data:;
     frame-src 'self' https://analytics.data.amsterdam.nl;
     style-src 'self' 'unsafe-hashes' https://fast.fonts.net https://d6tizftlrpuof.cloudfront.net 'nonce-$ssl_session_id' 'sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=' 'sha256-32t0bJPIyxns/QqsW8RE3JGUERKnHL5RygHBgJvEanc=' 'sha256-Z8ql5uoWyhH3XVFK2nG2JIPy0JUew33X/cELWehWR4A=' 'sha256-Yz3WVa4XD8fKk1TBfWFeJB50Hu3oNAqOITT6j+HP/bU=' 'sha256-wZZTZ+IFA1sJKRjoJqzAI+c8330AH2nKu0Oznam9G7E=' 'sha256-chVdzYfcS16n4LrShHQ68D1UQ4kaNvlNTrk9U8LotB8=' 'sha256-60Ytj0beJCJifpdQUv6f9B7nWDqJFAOl3JD93YK/ZHI=' 'sha256-P4Py+dtzN88J0dU5FdWseXYhd9tUo0/yyy3hpkzPSjc=';
     font-src 'self' https://d6tizftlrpuof.cloudfront.net;
     manifest-src 'self';
     object-src 'none';
     frame-ancestors 'self';";

  add_header Referrer-Policy "same-origin";

  add_header Permissions-Policy "geolocation=(),midi=(),sync-xhr=(),microphone=(),camera=(),magnetometer=(),gyroscope=(),fullscreen=(self),payment=()";

	listen 80;
	server_name localhost;

  location ~ /\.ht {
      deny all;
  }

  set $landing_page "index";

  location / {
    root /usr/share/nginx/html;
    try_files $uri $uri/ /index.html =404;
  }

  location /no-support {
    index no_support.html;
    try_files $uri $uri/ /no_support.html;
  }

  # Redirect to TMA session ender URL
  rewrite ^/logout$ $LOGOUT_URL redirect;
}
