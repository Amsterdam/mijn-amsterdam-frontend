server {
  # Add strict csp header config
  add_header Content-Security-Policy
    "default-src 'none';
    connect-src 'self' https://data.amsterdam.nl https://api.data.amsterdam.nl https://analytics.data.amsterdam.nl https://api.usabilla.com https://sentry.data.amsterdam.nl;
    script-src 'self' https://analytics.data.amsterdam.nl https://*.usabilla.com http://*.usabilla.com 'unsafe-inline' 'unsafe-eval';
    img-src 'self' https://analytics.data.amsterdam.nl https://d6tizftlrpuof.cloudfront.net https://*.usabilla.com data:;
    frame-src 'self' https://analytics.data.amsterdam.nl https://data.amsterdam.nl;
    style-src 'self' https://fast.fonts.net https://d6tizftlrpuof.cloudfront.net 'unsafe-inline';
    font-src 'self' https://d6tizftlrpuof.cloudfront.net;
    manifest-src 'self';
    object-src 'none';
    frame-ancestors 'none';";

	listen 80;
	server_name localhost;

  location ~ /\.ht {
      deny all;
  }

  # If the base url of the server is proxied via TMA and receives a saml token, make landing_page login
  set $landing_page "index";
  # Check to see if we received a valid saml token header from the TMA
  # if ( $http_x_saml_attribute_token1 ) {
  #  set $landing_page "index";
  # }
  # if ( $http_x_saml_attribute_token2 ) {
  #   set $landing_page "index";
  # }


  location / {
    root /usr/share/nginx/html;
    try_files $uri $uri/ /index.html =404;
  }

  # Redirect to TMA session ender URL
  rewrite ^/logout$ $LOGOUT_URL redirect;
}
