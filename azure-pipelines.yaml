trigger:
  branches:
    include:
      - ontwikkelen
      - testen
      - acceptatie
  # tags:
  #   include:
  #     - release-v*

pr:
  branches:
    include:
      - main

resources:
  repositories:
    - repository: MamsInfra
      type: git
      name: MijnAmsterdam/mijn-amsterdam-infra
      ref: refs/heads/pipeline-fe

variables:
  - ${{ if eq(variables['Build.SourceBranchName'], 'ontwikkelen') }}:
      - group: MAPipelineVariables-o
  - ${{ if eq(variables['Build.SourceBranchName'], 'testen') }}:
      - group: MAPipelineVariables-t
  - ${{ if eq(variables['Build.SourceBranchName'], 'acceptatie') }}:
      - group: MAPipelineVariables-a
  - ${{ if eq(variables['Build.SourceBranchName'], 'productie') }}:
      - group: MAPipelineVariables-p

stages:
  # - ${{ if eq(variables['Build.Reason'], 'PullRequest') }}:
  #     - template: pipelines/stages/build-applications.yaml@MamsInfra
  #     - template: pipelines/stages/test-applications.yaml@MamsInfra

  - ${{ if ne(variables['Build.Reason'], 'PullRequest') }}:
      - template: pipelines/stages/deploy-infra-test.yaml@MamsInfra
        parameters:
          serviceConnectionName: $(serviceConnectionName)
      # - template: pipelines/stages/build-applications.yaml@MamsInfra
      # - template: pipelines/stages/test-applications.yaml@MamsInfra
      # - template: pipelines/stages/deploy-applications.yaml@MamsInfra
