import {
  ActionGroup,
  Alert,
  Grid,
  GridColumnNumber,
  Icon,
  Paragraph,
} from '@amsterdam/design-system-react';
import { ExternalLinkIcon } from '@amsterdam/design-system-react-icons';

import { CONTENT_EMPTY, isVergunning } from './helper';
import styles from './Varen.module.scss';
import { VarenDisclaimerRederNotRegistered } from './VarenThema';
import type {
  VarenZakenFrontend,
  VarenVergunningExploitatieType,
} from '../../../../server/services/varen/config-and-types';
import { ButtonLinkProps } from '../../../../universal/types/App.types';
import { Datalist, RowSet } from '../../../components/Datalist/Datalist';
import { MaButtonLink, MaRouterLink } from '../../../components/MaLink/MaLink';
import { WithDetailLinkComponent } from '../../../components/Table/TableV2';

type VarenDetailPageContentProps = {
  zaak: VarenZakenFrontend<VarenVergunningExploitatieType>;
  linkedWijzigingZaak: WithDetailLinkComponent<VarenZakenFrontend> | null;
  hasRegistratieReder: boolean;
  buttonItems: ButtonLinkProps[];
};

const DEFAULT_GRID_SPAN: GridColumnNumber = 4;
export function VarenDetailPageContentExploitatie({
  zaak,
  linkedWijzigingZaak,
  hasRegistratieReder,
  buttonItems,
}: VarenDetailPageContentProps) {
  const zaakVergunning = zaak.processed ? zaak.vergunning : zaak;

  const rows: RowSet[] = [
    {
      rows: [
        {
          label: 'Naam vaartuig',
          content: zaakVergunning?.vesselName || CONTENT_EMPTY,
          span: DEFAULT_GRID_SPAN,
        },
        {
          label: 'Segment',
          content: zaakVergunning?.segment || CONTENT_EMPTY,
          span: DEFAULT_GRID_SPAN,
        },
      ],
    },
    {
      rows: [
        {
          label: 'Lengte vaartuig',
          content: zaakVergunning?.vesselLength
            ? `${zaakVergunning.vesselLength} meter`
            : CONTENT_EMPTY,
          span: DEFAULT_GRID_SPAN,
        },
        {
          label: 'Breedte vaartuig',
          content: zaakVergunning?.vesselWidth
            ? `${zaakVergunning.vesselWidth} meter`
            : CONTENT_EMPTY,
          span: DEFAULT_GRID_SPAN,
        },
      ],
    },
    {
      rows: [
        zaak.processed
          ? {
              label: 'Vergunningkenmerk',
              content: zaak.vergunning?.identifier || CONTENT_EMPTY,
              span: DEFAULT_GRID_SPAN,
            }
          : {
              label: 'Zaakkenmerk',
              content: zaak.identifier || CONTENT_EMPTY,
              span: DEFAULT_GRID_SPAN,
            },
        {
          label: 'ENI-nummer',
          content: zaakVergunning?.eniNumber || CONTENT_EMPTY,
          span: DEFAULT_GRID_SPAN,
        },
      ],
    },
  ];

  const showRederAlert = isVergunning(zaak) && !hasRegistratieReder;
  const showWijzigingInProgressAlert =
    isVergunning(zaak) && linkedWijzigingZaak;
  const showButtons =
    isVergunning(zaak) &&
    !showRederAlert &&
    !showWijzigingInProgressAlert &&
    buttonItems?.length > 0;

  return (
    <>
      <Grid.Cell span="all">
        <Datalist rows={rows} className={styles.VarenGridWithoutRowGap} />
      </Grid.Cell>
      {showButtons && (
        <Grid.Cell span="all">
          <ActionGroup>
            {buttonItems.map(({ to, title, isDisabled }) => (
              <MaButtonLink
                key={to}
                href={to}
                isDisabled={isDisabled}
                variant="secondary"
              >
                {title}
                <Icon svg={ExternalLinkIcon} size="heading-5" />
              </MaButtonLink>
            ))}
          </ActionGroup>
        </Grid.Cell>
      )}
      {showRederAlert && VarenDisclaimerRederNotRegistered}
      {showWijzigingInProgressAlert && (
        <Grid.Cell span="all">
          <Alert heading="Wijziging in behandeling" headingLevel={4}>
            <Paragraph>
              U kunt geen wijziging indienen omdat u al een wijzigingsaanvraag
              heeft lopen. Als uw wijzigingsaanvraag is afgrond kunt u hier een
              nieuwe wijziging aanvragen.
              {linkedWijzigingZaak.link?.to && (
                <MaRouterLink href={linkedWijzigingZaak.link.to}>
                  Bekijk ingediende wijziging
                </MaRouterLink>
              )}
            </Paragraph>
          </Alert>
        </Grid.Cell>
      )}
    </>
  );
}
